# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Overview

This is x-context, a CLI tool that converts AI coding tool context files between different formats using AI-powered conversion. The tool helps users migrate context files between AI coding assistants (e.g., from Claude Code to Cursor) by leveraging the Vercel AI SDK's structured output capabilities.

**Supported Formats**: copilot, claude-code, cursor, gemini-cli
**Supported Providers**: anthropic, gemini, openai

## Development Commands

- **Build**: `pnpm build` - Uses tsdown to compile TypeScript and generate dist/
- **Lint & Format**: `pnpm biome check` - Runs Biome linter and formatter  
- **Format**: `pnpm biome check --write` - Auto-fixes formatting issues
- **Update Models**: `pnpm prebuild` - Extracts latest model lists from AI SDK packages
- **Test CLI**: `npx tsx src/index.ts --from claude-code --to cursor --provider openai ./CLAUDE.md`
- **Test Built CLI**: `node dist/index.js --from claude-code --to cursor --provider openai ./CLAUDE.md`
- **Test with Model**: `npx tsx src/index.ts --from claude-code --to cursor --model o3 ./CLAUDE.md`
- **Test Multiple Files**: `npx tsx src/index.ts --from claude-code --to cursor --provider openai ./CLAUDE.md ./README.md`

## Architecture

### Core System
- **Package Manager**: pnpm (version 10.12.3)
- **Build Tool**: tsdown for TypeScript compilation with minification and declaration files
- **Code Quality**: Biome for linting and formatting
- **Runtime Validation**: Zod for CLI argument validation and AI output parsing
- **Progress Feedback**: Ora spinners for detailed user feedback

### AI Integration Architecture
- **Vercel AI SDK**: Uses `generateObject()` with unified interface for multiple providers
- **Multi-Provider Support**: Seamless switching between Anthropic and OpenAI with same API
- **Documentation System**: Automatically fetches format-specific documentation from live URLs
- **Prompt Engineering**: Comprehensive system prompt that includes source/target docs and conversion requirements
- **Structured Output**: Zod schemas ensure type-safe AI responses

## Project Structure

- `src/index.ts` - Main CLI entry point with Commander.js, ora spinners, and orchestration logic
- `src/constants.ts` - Supported formats, providers, documentation URLs, and auto-generated model lists
- `src/convert.ts` - AI-powered conversion logic with multi-provider AI integration
- `scripts/build-supported-models.ts` - TypeScript AST parser that extracts model types from AI SDK packages
- `dist/` - Compiled output (generated by build)

## Key Implementation Details

### CLI Flow
1. **Validation**: Zod schemas validate CLI arguments (--from, --to, --provider, optional --model)
2. **Model Selection**: Uses default models (claude-4-sonnet-20250514 for Anthropic, gemini-2.5-flash-preview-04-17 for Gemini, o4-mini for OpenAI) if --model not specified
3. **Documentation Fetching**: Downloads format documentation with progress feedback
4. **AI Conversion**: Sends comprehensive prompt to AI with structured output schema
5. **User Confirmation**: Shows file paths and asks for confirmation before writing
6. **File Output**: Creates directories if needed and writes converted files with paths determined by AI response

### Conversion System
- **Documentation URLs**: Live documentation fetched for accurate, up-to-date conversions
- **Structured Output**: AI returns `{files: [{path: string, content: string}]}` validated by Zod
- **Model Routing**: Defaults to claude-4-sonnet-20250514 for Anthropic, gemini-2.5-flash-preview-04-17 for Gemini, and o4-mini for OpenAI when --model not specified
- **Error Handling**: Comprehensive error handling with user-friendly messages and spinner feedback
- **Directory Handling**: Automatically creates parent directories when writing files with nested paths
- **User Safety**: Prompts for confirmation before writing files, showing all paths that will be created

### Environment Variables
- `ANTHROPIC_API_KEY` - Required when using `--provider=anthropic`
- `GOOGLE_GENERATIVE_AI_API_KEY` - Required when using `--provider=gemini`
- `OPENAI_API_KEY` - Required when using `--provider=openai`

### Model Management System
- **Automated Model Extraction**: `scripts/build-supported-models.ts` automatically extracts available models from AI SDK packages using TypeScript compiler API
- **Pre-build Hook**: Models are updated before each build via `prebuild` script to ensure latest model support
- **TypeScript AST Parsing**: Parses union types from `@ai-sdk/*` internal type definitions to generate model arrays
- **Future-proof**: New models in AI SDK packages are automatically supported without manual code changes

## Configuration Notes

- Uses strict TypeScript configuration with ESNext target
- Biome enforces unused imports/variables as errors, uses tab indentation and double quotes
- ESM-only architecture with node: protocol imports  
- Version auto-synced from package.json in CLI interface
- CLI published as `x-context` binary pointing to `dist/index.js`
