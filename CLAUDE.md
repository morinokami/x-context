# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Overview

This is x-context, a CLI tool that converts AI coding tool configuration files between different formats using AI-powered conversion. The tool helps users migrate configurations between AI coding assistants (e.g., from Claude Code to Cursor) by leveraging the Vercel AI SDK's structured output capabilities.

**Supported Formats**: copilot, claude-code, cursor, gemini-cli
**Supported Providers**: openai, anthropic

## Development Commands

- **Build**: `pnpm build` - Uses tsdown to compile TypeScript and generate dist/
- **Lint & Format**: `pnpm biome check` - Runs Biome linter and formatter  
- **Format**: `pnpm biome format --write` - Auto-fixes formatting issues
- **Test CLI**: `npx tsx src/index.ts --from=claude-code --to=cursor --provider=openai ./CLAUDE.md`
- **Test Built CLI**: `node dist/index.js --from=claude-code --to=cursor --provider=openai ./CLAUDE.md`
- **Test with Model**: `npx tsx src/index.ts --from=claude-code --to=cursor --provider=anthropic --model=claude-4-sonnet-20250514 ./CLAUDE.md`

## Architecture

### Core System
- **Package Manager**: pnpm (version 10.12.3)
- **Build Tool**: tsdown for TypeScript compilation with minification and declaration files
- **Code Quality**: Biome for linting and formatting
- **Runtime Validation**: Zod for CLI argument validation and AI output parsing
- **Progress Feedback**: Ora spinners for detailed user feedback

### AI Integration Architecture
- **Vercel AI SDK**: Uses `generateObject()` with unified interface for multiple providers
- **Multi-Provider Support**: Seamless switching between OpenAI and Anthropic with same API
- **Documentation System**: Automatically fetches format-specific documentation from live URLs
- **Prompt Engineering**: Comprehensive system prompt that includes source/target docs and conversion requirements
- **Structured Output**: Zod schemas ensure type-safe AI responses

## Project Structure

- `src/index.ts` - Main CLI entry point with Commander.js, ora spinners, and orchestration logic
- `src/constants.ts` - Supported formats, providers, documentation URLs, and package version
- `src/convert.ts` - AI-powered conversion logic with multi-provider AI integration
- `dist/` - Compiled output (generated by build)

## Key Implementation Details

### CLI Flow
1. **Validation**: Zod schemas validate CLI arguments (--from, --to, --provider, optional --model)
2. **Model Selection**: Uses default models (o4-mini for OpenAI, claude-4-sonnet-20250514 for Anthropic) if --model not specified
3. **Documentation Fetching**: Downloads format documentation with progress feedback
4. **AI Conversion**: Sends comprehensive prompt to AI with structured output schema
5. **File Output**: Creates directories if needed and writes converted files with paths determined by AI response

### Conversion System
- **Documentation URLs**: Live documentation fetched for accurate, up-to-date conversions
- **Structured Output**: AI returns `{files: [{path: string, content: string}]}` validated by Zod
- **Single File Preference**: Prompt instructs AI to avoid file splitting unless necessary
- **Model Routing**: Defaults to o4-mini for OpenAI and claude-4-sonnet-20250514 for Anthropic when --model not specified
- **Error Handling**: Comprehensive error handling with user-friendly messages and spinner feedback
- **Directory Handling**: Automatically creates parent directories when writing files with nested paths

### Environment Variables
- `OPENAI_API_KEY` - Required when using `--provider=openai`
- `ANTHROPIC_API_KEY` - Required when using `--provider=anthropic`

## Configuration Notes

- Uses strict TypeScript configuration with ESNext target
- Biome enforces unused imports/variables as errors, uses tab indentation and double quotes
- ESM-only architecture with node: protocol imports  
- Version auto-synced from package.json in CLI interface
- CLI published as `x-context` binary pointing to `dist/index.js`
